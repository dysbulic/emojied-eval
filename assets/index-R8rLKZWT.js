import{r as l,j as r,a as q}from"./index-m5OJZ77t.js";import{u as x,e as _}from"./utils-i3GMXlaZ.js";import{u as b}from"./useQuery-fgC45wca.js";const R="_listGrid_q99ex_1",E="_reactions_q99ex_1",g={listGrid:R,reactions:E,"use-rubric":"_use-rubric_q99ex_21"},S=(e,n)=>b({queryKey:["feedbacks",n,e],queryFn:async()=>{const{data:s,error:a}=await e.from("feedbacks").select().in("id",n);if(a)throw a;return Object.fromEntries(s.map(({id:i,image:u})=>[i,u]))},enabled:!!e}),k=(e,n)=>b({queryKey:["rubrics",n,e],queryFn:async()=>{let s=e.from("rubrics").select("id, name, default_weight");n&&(s=s.eq("feedback_group_id",n));const{data:a,error:i}=await s;if(i)throw i;return a},enabled:!!e}),W=(e,n)=>b({queryKey:["rubrics",n,e],queryFn:async()=>{if(!e)throw new Error("`supabase` not available.");let s=e.from("feedback_weights").select("feedback_id, weight");n&&(s=s.eq("rubric_id",n));const{data:a,error:i}=await s;if(i)throw i;return Object.fromEntries(a.map(({feedback_id:u,weight:d})=>[u,d]))},enabled:!!e}),v=({video:e})=>{const n=l.useMemo(()=>{const t={};return e.reactions.forEach(({feedback_id:c})=>{t[c]??(t[c]=0),t[c]++}),t},[e.reactions]),[s,a]=l.useState(),[i,u]=l.useState({}),[d,y]=l.useState(),{supabase:h}=x(),{data:f}=S(h,Object.keys(n)),{data:o}=k(h,e.feedback_group_id),{data:m}=W(h,e.feedback_group_id);return l.useEffect(()=>{m&&u(m)},[m]),r.jsxs("section",{id:g.reactions,children:[r.jsx("h2",{children:"Weighted Reactions"}),r.jsxs("form",{className:g["use-rubric"],onSubmit:()=>{a(o==null?void 0:o.find(({id:t})=>t===d))},children:[r.jsx("input",{id:"rubric",onChange:({target:{value:t}})=>y(t),value:d??"",list:"rubrics"}),r.jsxs("datalist",{id:"rubrics",children:[r.jsx("option",{value:"",children:"Choose a Rubricâ€¦"}),o==null?void 0:o.map(({id:t,name:c})=>r.jsx("option",{value:t,children:c},t))]}),r.jsxs("nav",{children:[o&&(o==null?void 0:o.length)>0&&r.jsx("button",{children:"â¤ŸðŸ’¾ Load a Rubric"}),r.jsx("button",{type:"button",onClick:async()=>{const{data:t}=await h.from("rubrics").insert({feedback_group_id:e.feedback_group_id,name:s,default_weight:1}).single()??{};a(t)},children:"â¤ŸðŸ—ƒ Add a Rubric"}),s&&r.jsx("button",{type:"button",onClick:()=>{u({}),a(null)},children:"â¤ŸðŸ–¥ Update a Rubric"})]})]}),r.jsx("ul",{className:g.listGrid,children:Object.entries(n).map(([t,c])=>{const j=(i==null?void 0:i[t])??(s==null?void 0:s.default_weight)??0;return r.jsxs("li",{children:[_(f==null?void 0:f[t]),r.jsx("input",{id:`count-${t}`,type:"number",value:c,readOnly:!0}),r.jsx("input",{id:`weight-${t}`,type:"number",value:j,onChange:({target:{value:p}})=>{u(w=>({...w,[t]:p}))}}),r.jsx("output",{children:(c*Number(j)).toLocaleString()})]},t)})})]})},C=v,K=()=>{const{supabase:e}=x(),{uuid:n}=q(),{data:s,isLoading:a}=b({queryKey:["score",n,{supabase:e}],queryFn:async()=>{if(!e)throw new Error("`supabase` not available.");const{data:i}=await e.from("videos").select(`
          id, title, feedback_group_id,
          reactions (*)
        `).eq("id",n).single();return i},enabled:!!e});return a?r.jsx("p",{children:"Loadingâ€¦"}):r.jsxs("article",{children:[r.jsxs("h1",{children:["Scoring: ",r.jsx("q",{children:s==null?void 0:s.title})]}),r.jsx(C,{video:s})]})};export{K as Score,K as default};
