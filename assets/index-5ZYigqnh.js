import{r as a,j as e,L as b}from"./index-aJe0aa89.js";import{u as y}from"./utils-40nqDg4W.js";import{H as V}from"./index-KuxAdbYG.js";import{f as x}from"./form.module-NCFyfnK-.js";import{u as k}from"./useQuery-DjHnRFo0.js";import"./index-t1siDvdY.js";const N="_form_1b9hj_1",q="_buttons_1b9hj_36",L="_noneOption_1b9hj_46",F="_split_1b9hj_52",_={form:N,buttons:q,noneOption:L,split:F},R=a.forwardRef(({video:t,onClose:o},s)=>{const{supabase:i}=y(),h=a.useRef(null),l=a.useCallback(()=>{var c,r;(c=h.current)==null||c.reset(),s instanceof Function||(r=s==null?void 0:s.current)==null||r.close(),o==null||o()},[s,o]);a.useEffect(()=>{if(!(s instanceof Function)){const c=l,r=s==null?void 0:s.current;return r==null||r.addEventListener("close",c),()=>r==null?void 0:r.removeEventListener("close",c)}},[l,s]);const f=async c=>{if(!i)throw new Error("Supabase not defined.");const r=c.currentTarget.elements,d={id:t==null?void 0:t.id,url:r.url.value,title:r.title.value,description:r.description.value,feedback_group_id:r.group.value||void 0},n=document.createElement("video");d.duration=await new Promise(j=>{n.addEventListener("loadedmetadata",()=>{j(n.duration)}),n.src=d.url}),console.log({values:d}),await i.from("videos").upsert(d),l()},{isLoading:p,error:m,data:u}=k({queryKey:["VideoForm",{supabase:i}],enabled:!!i,queryFn:async()=>{const{data:c,error:r}=await(i==null?void 0:i.from("feedback_groups").select())??{};if(r)throw r;return c}});if(m)throw m;return e.jsx("dialog",{ref:s,className:_.dialog,children:e.jsxs("form",{onSubmit:f,method:"dialog",className:x.form,ref:h,children:[e.jsxs("label",{children:[e.jsx("h3",{children:"URL"}),e.jsx("input",{id:"url",defaultValue:t==null?void 0:t.url,required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Title"}),e.jsx("input",{id:"title",defaultValue:t==null?void 0:t.title,required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Description"}),e.jsx("textarea",{id:"description",defaultValue:(t==null?void 0:t.description)??""})]}),e.jsxs("label",{children:[e.jsx("h3",{className:_.split,children:"Feedback Group"}),p?e.jsx("p",{children:"Loadingâ€¦"}):e.jsxs("select",{id:"group",defaultValue:t==null?void 0:t.feedback_group_id,children:[e.jsx("option",{value:"",className:_.noneOption,children:"None"}),u==null?void 0:u.map(c=>e.jsx("option",{value:c.id,selected:c.id===(t==null?void 0:t.feedback_group_id),children:c.title},c.id))]})]}),e.jsxs("div",{className:x.buttons,children:[e.jsx("button",{type:"button",onClick:l,className:x.cancel,children:"Cancel"}),e.jsx("button",{className:x.submit,children:t?"Update":"Create"})]})]})})}),T=R,C="_header_1houp_1",$="_outer_1houp_1",O="_olTable_1houp_25",w={header:C,outer:$,olTable:O},S=t=>k({queryKey:["Videos",t],enabled:!!t,queryFn:async()=>{const{data:o,error:s}=await(t==null?void 0:t.from("videos").select())??{};if(s)throw s;return o}}),M=()=>{const t=a.useRef(null),{supabase:o,error:s}=y(),{isLoading:i,error:h,data:l,refetch:f}=S(o),[p,m]=a.useState(null),u=async()=>{var n;(n=t.current)==null||n.showModal()},c=a.useCallback(()=>{m(null),f()},[f]),r=n=>{const j=l==null?void 0:l.find(E=>E.id===n);if(!j)throw new Error(`No video found with id: "${n}".`);m(j),u()},d=async n=>{await(o==null?void 0:o.from("videos").delete().eq("id",n)),f()};if(s)throw s;if(h)throw h;return e.jsxs("article",{id:w.outer,children:[e.jsxs(V,{children:[e.jsx("h1",{children:"Videos"}),e.jsx("button",{onClick:u,className:"square",children:"âž•"})]}),e.jsx(T,{video:p,onClose:c,ref:t}),e.jsx("main",{className:w.olTable,children:i?e.jsx("p",{children:"Loadingâ€¦"}):e.jsx("ol",{children:l==null?void 0:l.map(n=>e.jsxs("li",{children:[e.jsx("h2",{children:e.jsx(b,{to:`/eval/${n.id}`,children:n.title})}),e.jsx("div",{children:n.description}),e.jsxs("nav",{children:[e.jsx("button",{onClick:()=>r(n.id),children:"ðŸ–‰"}),e.jsx("button",{onClick:()=>d(n.id),children:"âž–"}),e.jsx(b,{to:`/score/${n.id}`,children:"ðŸŽ¼"})]})]},n.id))})})]})};export{M as Videos,M as default};
