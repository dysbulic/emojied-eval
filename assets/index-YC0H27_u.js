import{r as l,j as t,a as w}from"./index-D4CTEBZ-.js";import{u as y,e as _}from"./utils-8aVrX_ZJ.js";import{u as h}from"./useQuery-cppXtXyb.js";const R="_listGrid_q99ex_1",E="_reactions_q99ex_1",b={listGrid:R,reactions:E,"use-rubric":"_use-rubric_q99ex_21"},S=(e,n)=>h({queryKey:["feedbacks",n,e],queryFn:async()=>{const{data:s,error:a}=await e.from("feedbacks").select().in("id",n);if(a)throw a;return Object.fromEntries(s.map(({id:i,image:c})=>[i,c]))},enabled:!!e}),v=(e,n)=>h({queryKey:["rubrics",n,e],queryFn:async()=>{let s=e.from("rubrics").select("id, name, default_weight");n&&(s=s.eq("feedback_group_id",n));const{data:a,error:i}=await s;if(i)throw i;return a},enabled:!!e}),W=(e,n)=>h({queryKey:["rubrics",n,e],queryFn:async()=>{if(!e)throw new Error("`supabase` not available.");let s=e.from("feedback_weights").select("feedback_id, weight");n&&(s=s.eq("rubric_id",n));const{data:a,error:i}=await s;if(i)throw i;return Object.fromEntries(a.map(({feedback_id:c,weight:d})=>[c,d]))},enabled:!!e}),F=({video:e})=>{const n=l.useMemo(()=>{const r={};return e.reactions.forEach(({feedback_id:o})=>{r[o]??(r[o]=0),r[o]++}),r},[e.reactions]),[s,a]=l.useState(),[i,c]=l.useState({}),[d,g]=l.useState(),{supabase:m}=y(),{data:j}=S(m,Object.keys(n)),{data:u}=v(m,e.feedback_group_id),{data:x}=W(m,e.feedback_group_id);return l.useEffect(()=>{x&&c(x)},[x]),t.jsxs("section",{id:b.reactions,children:[t.jsx("h2",{children:"Weighted Reactions"}),t.jsxs("form",{className:b["use-rubric"],onSubmit:()=>{a(u==null?void 0:u.find(({id:r})=>r===d))},children:[t.jsx("input",{id:"rubric",onChange:({target:{value:r}})=>g(r),value:d??"",list:"rubrics"}),t.jsxs("datalist",{id:"rubrics",children:[t.jsx("option",{value:"",children:"Choose a Rubricâ€¦"}),u==null?void 0:u.map(({id:r,name:o})=>t.jsx("option",{value:r,children:o},r))]}),t.jsxs("nav",{children:[t.jsx("button",{children:"â¤ŸðŸ’¾ Load a Rubric"}),t.jsx("button",{children:"â¤ŸðŸ—ƒ Add a Rubric"})]})]}),t.jsx("ul",{className:b.listGrid,children:Object.entries(n).map(([r,o])=>{const f=(i==null?void 0:i[r])??(s==null?void 0:s.default_weight)??0;return t.jsxs("li",{children:[_(j==null?void 0:j[r]),t.jsx("input",{id:`count-${r}`,type:"number",value:o,readOnly:!0}),t.jsx("input",{id:`weight-${r}`,type:"number",value:f,onChange:({target:{value:p}})=>{c(q=>({...q,[r]:p}))}}),t.jsx("output",{children:(o*Number(f)).toLocaleString()})]},r)})})]})},O=F,C=()=>{const{supabase:e}=y(),{uuid:n}=w(),{data:s,isLoading:a}=h({queryKey:["score",n,{supabase:e}],queryFn:async()=>{if(!e)throw new Error("`supabase` not available.");const{data:i}=await e.from("videos").select(`
          id, title, feedback_group_id,
          reactions (*)
        `).eq("id",n).single();return i},enabled:!!e});return a?t.jsx("p",{children:"Loadingâ€¦"}):t.jsxs("article",{children:[t.jsxs("h1",{children:["Scoring: ",t.jsx("q",{children:s==null?void 0:s.title})]}),t.jsx(O,{video:s})]})};export{C as Score,C as default};
