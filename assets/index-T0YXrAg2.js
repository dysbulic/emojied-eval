import{r as a,j as e,L as y}from"./index-HnMESvCI.js";import{u as k}from"./utils-CmX715-H.js";import{H as q}from"./index-XbwgQRAG.js";import{f as p}from"./form.module-ntuGhauS.js";import{u as N}from"./useQuery-G1LIUDhe.js";import"./index-cRkABk7z.js";const L="_form_1b9hj_1",T="_buttons_1b9hj_36",g="_noneOption_1b9hj_46",F="_split_1b9hj_52",_={form:L,buttons:T,noneOption:g,split:F},R=a.forwardRef(({video:t,onClose:l},s)=>{const{supabase:i}=k(),h=a.useRef(null),c=a.useCallback(()=>{var o,r;(o=h.current)==null||o.reset(),s instanceof Function||(r=s==null?void 0:s.current)==null||r.close(),l==null||l()},[s,l]);a.useEffect(()=>{if(!(s instanceof Function)){const o=c,r=s==null?void 0:s.current;return r==null||r.addEventListener("close",o),()=>r==null?void 0:r.removeEventListener("close",o)}},[c,s]);const f=async o=>{if(!i)throw new Error("Supabase not defined.");const r=o.currentTarget.elements,d={id:t==null?void 0:t.id,url:r.url.value,title:r.title.value,description:r.description.value},n=document.createElement("video");d.duration=await new Promise(V=>{n.addEventListener("loadedmetadata",()=>{var w;V(((w=new Date(n.duration*1e3).toISOString().split("T").at(-1))==null?void 0:w.replace(/\w$/g,""))??null)}),n.src=d.url}),console.log({values:d});const{data:j,error:x}=await i.from("videos").upsert(d).select("id").single()??{};if(x)throw x;console.debug({vid:j}),await i.from("feedback_groups_videos").upsert({video_id:j.id,group_id:r.group.value}),c()},{isLoading:b,error:m,data:u}=N({queryKey:["VideoForm",{supabase:i}],enabled:!!i,queryFn:async()=>{const{data:o,error:r}=await(i==null?void 0:i.from("feedback_groups").select())??{};if(r)throw r;return o}});if(m)throw m;return e.jsx("dialog",{ref:s,className:_.dialog,children:e.jsxs("form",{onSubmit:f,method:"dialog",className:p.form,ref:h,children:[e.jsxs("label",{children:[e.jsx("h3",{children:"URL"}),e.jsx("input",{id:"url",defaultValue:(t==null?void 0:t.url)??"",required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Title"}),e.jsx("input",{id:"title",defaultValue:(t==null?void 0:t.title)??"",required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Description"}),e.jsx("textarea",{id:"description",defaultValue:(t==null?void 0:t.description)??""})]}),e.jsxs("label",{children:[e.jsx("h3",{className:_.split,children:"Feedback Group"}),b?e.jsx("p",{children:"Loadingâ€¦"}):e.jsxs("select",{id:"group",children:[e.jsx("option",{value:"",className:_.noneOption,children:"None"}),u==null?void 0:u.map(o=>e.jsx("option",{value:o.id,children:o.title},o.id))]})]}),e.jsxs("div",{className:p.buttons,children:[e.jsx("button",{type:"button",onClick:c,className:p.cancel,children:"Cancel"}),e.jsx("button",{className:p.submit,children:t?"Update":"Create"})]})]})})}),S=R,$="_header_1houp_1",C="_outer_1houp_1",O="_olTable_1houp_25",E={header:$,outer:C,olTable:O},D=t=>N({queryKey:["Videos",t],enabled:!!t,queryFn:async()=>{const{data:l,error:s}=await(t==null?void 0:t.from("videos").select())??{};if(s)throw s;return l}}),P=()=>{const t=a.useRef(null),{supabase:l,error:s}=k(),{isLoading:i,error:h,data:c,refetch:f}=D(l),[b,m]=a.useState(null),u=async()=>{var n;(n=t.current)==null||n.showModal()},o=a.useCallback(()=>{m(null),f()},[f]),r=n=>{const j=c==null?void 0:c.find(x=>x.id===n);if(!j)throw new Error(`No video found with id: "${n}".`);m(j),u()},d=async n=>{await(l==null?void 0:l.from("videos").delete().eq("id",n)),f()};if(s)throw s;if(h)throw h;return e.jsxs("article",{id:E.outer,children:[e.jsxs(q,{children:[e.jsx("h1",{children:"Videos"}),e.jsx("button",{onClick:u,className:"square",children:"âž•"})]}),e.jsx(S,{video:b,onClose:o,ref:t}),e.jsx("main",{className:E.olTable,children:i?e.jsx("p",{children:"Loadingâ€¦"}):e.jsx("ol",{children:c==null?void 0:c.map(n=>e.jsxs("li",{children:[e.jsx("h2",{children:e.jsx(y,{to:`/eval/${n.id}`,children:n.title})}),e.jsx("div",{children:n.description}),e.jsxs("nav",{children:[e.jsx("button",{onClick:()=>r(n.id),children:"ðŸ–‰"}),e.jsx("button",{onClick:()=>d(n.id),children:"âž–"}),e.jsx(y,{to:`/score/${n.id}`,children:"ðŸŽ¼"})]})]},n.id))})})]})};export{P as Videos,P as default};
