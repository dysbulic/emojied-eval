import{r as u,j as e,L as E}from"./index-D4CTEBZ-.js";import{u as y}from"./utils-8aVrX_ZJ.js";import{H as N}from"./index-LiItE4P8.js";import{f as x}from"./form.module-NCFyfnK-.js";import{u as w}from"./useQuery-cppXtXyb.js";import"./index-rwhNsM-d.js";const V="_form_1b9hj_1",q="_buttons_1b9hj_36",L="_noneOption_1b9hj_46",g="_split_1b9hj_52",b={form:V,buttons:q,noneOption:L,split:g},T=u.forwardRef(({video:t,onClose:l},o)=>{const{supabase:a}=y(),f=u.useRef(null),c=u.useCallback(()=>{var s,n;(s=f.current)==null||s.reset(),o instanceof Function||(n=o==null?void 0:o.current)==null||n.close(),l==null||l()},[o,l]);u.useEffect(()=>{if(!(o instanceof Function)){const s=c,n=o==null?void 0:o.current;return n==null||n.addEventListener("close",s),()=>n==null?void 0:n.removeEventListener("close",s)}},[c,o]);const m=async s=>{if(!a)throw new Error("Supabase not defined.");const n=s.currentTarget.elements,h={id:t==null?void 0:t.id,url:n.url.value,title:n.title.value,description:n.description.value,feedback_group_id:n.group.value||void 0},r=document.createElement("video");h.duration=await new Promise(i=>{r.addEventListener("loadedmetadata",()=>{i(r.duration)}),r.src=h.url}),console.log({values:h}),await a.from("videos").upsert(h),c()},{isLoading:p,error:j,data:d}=w({queryKey:["VideoForm",{supabase:a}],enabled:!!a,queryFn:async()=>{const{data:s,error:n}=await(a==null?void 0:a.from("feedback_groups").select())??{};if(n)throw n;return s}});if(j)throw j;return e.jsx("dialog",{ref:o,className:b.dialog,children:e.jsxs("form",{onSubmit:m,method:"dialog",className:x.form,ref:f,children:[e.jsxs("label",{children:[e.jsx("h3",{children:"URL"}),e.jsx("input",{id:"url",defaultValue:t==null?void 0:t.url,required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Title"}),e.jsx("input",{id:"title",defaultValue:t==null?void 0:t.title,required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Description"}),e.jsx("textarea",{id:"description",defaultValue:(t==null?void 0:t.description)??""})]}),e.jsxs("label",{children:[e.jsx("h3",{className:b.split,children:"Feedback Group"}),p?e.jsx("p",{children:"Loadingâ€¦"}):e.jsxs("select",{id:"group",defaultValue:t==null?void 0:t.feedback_group_id,children:[e.jsx("option",{value:"",className:b.noneOption,children:"None"}),d==null?void 0:d.map(s=>e.jsx("option",{value:s.id,selected:s.id===(t==null?void 0:t.feedback_group_id),children:s.title},s.id))]})]}),e.jsxs("div",{className:x.buttons,children:[e.jsx("button",{type:"button",onClick:c,className:x.cancel,children:"Cancel"}),e.jsx("button",{className:x.submit,children:t?"Update":"Create"})]})]})})}),C=T,F="_header_1houp_1",R="_outer_1houp_1",$="_olTable_1houp_25",_={header:F,outer:R,olTable:$},G=()=>{const t=u.useRef(null),{supabase:l,error:o}=y(),{isLoading:a,error:f,data:c,refetch:m}=w({queryKey:["Videos",{supabase:l}],enabled:!!l,queryFn:async()=>{const{data:r,error:i}=await(l==null?void 0:l.from("videos").select())??{};if(i)throw i;return r}}),[p,j]=u.useState(null),d=async()=>{var r;console.debug("Trying to open dialogâ€¦"),(r=t.current)==null||r.showModal()},s=u.useCallback(()=>{console.debug("Closing dialogâ€¦"),j(null),m()},[m]),n=r=>{const i=c==null?void 0:c.find(k=>k.id===r);if(!i)throw new Error(`No video found with id: "${r}".`);j(i),d()},h=async r=>{await(l==null?void 0:l.from("videos").delete().eq("id",r)),m()};if(o)throw o;if(f)throw f;return e.jsxs("article",{id:_.outer,children:[e.jsxs(N,{children:[e.jsx("h1",{children:"Videos"}),e.jsx("button",{onClick:d,className:"square",children:"âž•"})]}),e.jsx(C,{video:p,onClose:s,ref:t}),e.jsx("main",{className:_.olTable,children:a?e.jsx("p",{children:"Loadingâ€¦"}):e.jsx("ol",{children:c==null?void 0:c.map(r=>e.jsxs("li",{children:[e.jsx("h2",{children:e.jsx("a",{href:`eval/${r.id}`,children:r.title})}),e.jsx("div",{children:r.description}),e.jsxs("nav",{children:[e.jsx("button",{onClick:()=>n(r.id),children:"ðŸ–‰"}),e.jsx("button",{onClick:()=>h(r.id),children:"âž–"}),e.jsx(E,{to:`/score/${r.id}`,children:"ðŸŽ¼"})]})]},r.id))})})]})};export{G as Videos,G as default};
