import{r as o,u as p,z as y,A as R,B as _,j as s,b,i as S,k as W,c as $,d as w,H as E}from"./index-whC2bFQp.js";const q="_listGrid_xfabr_1",C="_reactions_xfabr_1",x={listGrid:q,reactions:C,"use-rubric":"_use-rubric_xfabr_21"},G=({video:t})=>{const c=o.useMemo(()=>{const e={};return t==null||t.reactions.forEach(({feedback_id:a})=>{e[a]??(e[a]=0),e[a]++}),e},[t==null?void 0:t.reactions]),[n,u]=o.useState(),[i,j]=o.useState({}),{supabase:l}=p(),{data:h}=y(l,Object.keys(c)),{data:r}=R(l),{data:d}=_(l,n,Object.keys(c));return o.useEffect(()=>{d&&j(d)},[d]),s.jsxs("section",{id:x.reactions,children:[s.jsx("h2",{children:"Weighted Reactions"}),!r||r.length===0?s.jsx(b,{to:"/rubrics",children:"Create a Rubric"}):s.jsx("form",{className:`${x["use-rubric"]} ${S.buttons}`,children:s.jsxs("select",{value:n==null?void 0:n.id,onChange:({target:{value:e}})=>{u(r==null?void 0:r.find(({id:a})=>a===e))},children:[s.jsx("option",{value:"",children:"Choose a Rubric"}),r==null?void 0:r.map(({id:e,name:a})=>s.jsx("option",{value:e,children:a},e))]})}),s.jsx("ul",{className:x.listGrid,children:Object.entries(c).map(([e,a])=>{const g=(i==null?void 0:i[e])??(n==null?void 0:n.default_weight)??0;return s.jsxs("li",{children:[W(h==null?void 0:h[e]),s.jsx("input",{id:`count-${e}`,type:"number",value:a,readOnly:!0}),s.jsx("input",{id:`weight-${e}`,type:"number",value:g,onChange:({target:{value:m}})=>{j(f=>({...f,[e]:m}))}}),s.jsx("output",{children:(a*Number(g)).toLocaleString()})]},e)})})]})},L=G,N=()=>{const{supabase:t}=p(),{uuid:c}=$(),{data:n,isLoading:u}=w({enabled:!!t,queryKey:["score",c,t],queryFn:async()=>{if(!t)throw new Error("`supabase` not available.");const{data:i}=await t.from("videos").select(`
          *,
          feedback_groups (feedbacks (*)),
          reactions (feedback_id)
        `).eq("id",c).single();return i}});return u?s.jsx("p",{children:"Loadingâ€¦"}):s.jsxs("article",{children:[s.jsx(E,{children:s.jsxs("h1",{children:["Scoring: ",s.jsx("q",{children:s.jsx(b,{to:`/eval/${c}`,children:n.title})})]})}),s.jsx(L,{video:n})]})};export{N as Score,N as default};
