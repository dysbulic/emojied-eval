import{r as a,j as e,L as y}from"./index-pr4DSQDq.js";import{u as k}from"./utils-0_tTNWTi.js";import{H as q}from"./index-poo61n5M.js";import{f as p}from"./form.module-ntuGhauS.js";import{u as N}from"./useQuery-Z4Rww5Th.js";import"./index-Ygv8cHQr.js";const L="_form_1b9hj_1",T="_buttons_1b9hj_36",F="_noneOption_1b9hj_46",R="_split_1b9hj_52",b={form:L,buttons:T,noneOption:F,split:R},S=a.forwardRef(({video:t,onClose:c},s)=>{const{supabase:l}=k(),d=a.useRef(null),i=a.useCallback(()=>{var o,r;(o=d.current)==null||o.reset(),s instanceof Function||(r=s==null?void 0:s.current)==null||r.close(),c==null||c()},[s,c]);a.useEffect(()=>{if(!(s instanceof Function)){const o=i,r=s==null?void 0:s.current;return r==null||r.addEventListener("close",o),()=>r==null?void 0:r.removeEventListener("close",o)}},[i,s]);const h=async o=>{if(!l)throw new Error("Supabase not defined.");const r=o.currentTarget.elements,m={id:t==null?void 0:t.id,url:r.url.value,title:r.title.value,description:r.description.value},n=document.createElement("video");m.duration=await new Promise(V=>{n.addEventListener("loadedmetadata",()=>{var w;V(((w=new Date(n.duration*1e3).toISOString().split("T").at(-1))==null?void 0:w.replace(/\w$/g,""))??null)}),n.src=m.url});const{data:j,error:x}=await l.from("videos").upsert(m).select("id").single()??{};if(x)throw x;await l.from("feedback_groups_videos").upsert({video_id:j.id,group_id:r.group.value}),i()},{isLoading:_,error:f,data:u}=N({queryKey:["VideoForm",{supabase:l}],enabled:!!l,queryFn:async()=>{const{data:o,error:r}=await(l==null?void 0:l.from("feedback_groups").select())??{};if(r)throw r;return o}});if(f)throw f;return e.jsx("dialog",{ref:s,className:b.dialog,children:e.jsxs("form",{onSubmit:h,method:"dialog",className:p.form,ref:d,children:[e.jsxs("label",{children:[e.jsx("h3",{children:"URL"}),e.jsx("input",{id:"url",defaultValue:(t==null?void 0:t.url)??"",required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Title"}),e.jsx("input",{id:"title",defaultValue:(t==null?void 0:t.title)??"",required:!0})]}),e.jsxs("label",{children:[e.jsx("h3",{children:"Description"}),e.jsx("textarea",{id:"description",defaultValue:(t==null?void 0:t.description)??""})]}),e.jsxs("label",{children:[e.jsx("h3",{className:b.split,children:"Feedback Group"}),_?e.jsx("p",{children:"Loadingâ€¦"}):e.jsxs("select",{id:"group",children:[e.jsx("option",{value:"",className:b.noneOption,children:"None"}),u==null?void 0:u.map(o=>e.jsx("option",{value:o.id,children:o.title},o.id))]})]}),e.jsxs("div",{className:p.buttons,children:[e.jsx("button",{type:"button",onClick:i,className:p.cancel,children:"Cancel"}),e.jsx("button",{className:p.submit,children:t?"Update":"Create"})]})]})})}),$=S,C="_header_1houp_1",O="_outer_1houp_1",g="_olTable_1houp_25",E={header:C,outer:O,olTable:g},D=t=>N({queryKey:["Videos",t],enabled:!!t,queryFn:async()=>{const{data:c,error:s}=await(t==null?void 0:t.from("videos").select())??{};if(s)throw s;return c}}),P=()=>{const t=a.useRef(null),{supabase:c,error:s}=k(),{isLoading:l,error:d,data:i,refetch:h}=D(c),[_,f]=a.useState(null),u=async()=>{var n;(n=t.current)==null||n.showModal()},o=a.useCallback(()=>{f(null),h()},[h]),r=n=>{const j=i==null?void 0:i.find(x=>x.id===n);if(!j)throw new Error(`No video found with id: "${n}".`);f(j),u()},m=async n=>{await(c==null?void 0:c.from("videos").delete().eq("id",n)),h()};if(s)throw s;if(d)throw d;return e.jsxs("article",{id:E.outer,children:[e.jsxs(q,{children:[e.jsx("h1",{children:"Videos"}),e.jsx("button",{onClick:u,className:"square",children:"âž•"})]}),e.jsx($,{video:_,onClose:o,ref:t}),e.jsx("main",{className:E.olTable,children:l?e.jsx("p",{children:"Loadingâ€¦"}):e.jsx("ol",{children:i==null?void 0:i.map(n=>e.jsxs("li",{children:[e.jsx("h2",{children:e.jsx(y,{to:`/eval/${n.id}`,children:n.title})}),e.jsx("div",{children:n.description}),e.jsxs("nav",{children:[e.jsx("button",{onClick:()=>r(n.id),children:"ðŸ–‰"}),e.jsx("button",{onClick:()=>m(n.id),children:"âž–"}),e.jsx(y,{to:`/score/${n.id}`,children:"ðŸŽ¼"})]})]},n.id))})})]})};export{P as Videos,P as default};
